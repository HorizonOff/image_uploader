<%= form_with(model: @image, url: category_images_path(main_image_id: @main_image_id), local: true) do |f| %>
  <div class="wrapper">
    <div class="header">
      <h3 class="text">New Image for <%= @current_category.title %></h3>
      <a href="<%= category_images_path %>" class="btn pull_right">Back</a>
    </div>

    <div class="main_form">
      <%= f.file_field :attachment, required: "required" %>
      <%= f.hidden_field :attachment_cache %>

      <% main_image = params[:main_image_id] || @main_image_id %>
      <%= f.hidden_field :main_image_id, value: main_image if main_image %>
      <%= f.hidden_field :category_id, value: @current_category.id %>
    </div>

    <% if @image.errors.any? %>
      <div class="error_message">
        <% @image.errors.full_messages.each do |message| %>
          <div><%= message %></div>
        <% end %>
      </div>
    <% end %>

    <div>
      <input type="submit" value="Upload file" />
    </div>
  </div>
<% end %>
